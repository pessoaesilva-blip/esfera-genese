<!DOCTYPE html>
<html lang="pt">
<head>
<meta charset="UTF-8">
<title>Esfera Gênese</title>
<style>
    body { margin:0; overflow:hidden; background:black; }
</style>
</head>
<body>

<script type="module">

import * as THREE from 'https://cdn.jsdelivr.net/npm/three@0.160.0/build/three.module.js';
import { OrbitControls } from 'https://cdn.jsdelivr.net/npm/three@0.160.0/examples/jsm/controls/OrbitControls.js';
import { EffectComposer } from 'https://cdn.jsdelivr.net/npm/three@0.160.0/examples/jsm/postprocessing/EffectComposer.js';
import { RenderPass } from 'https://cdn.jsdelivr.net/npm/three@0.160.0/examples/jsm/postprocessing/RenderPass.js';
import { UnrealBloomPass } from 'https://cdn.jsdelivr.net/npm/three@0.160.0/examples/jsm/postprocessing/UnrealBloomPass.js';


// ================= CENA =================
const scene = new THREE.Scene();
scene.background = new THREE.Color(0x000000);
scene.fog = new THREE.Fog(0x000000, 20, 150);

// ================= CAMERA =================
const camera = new THREE.PerspectiveCamera(75, window.innerWidth/window.innerHeight, 0.1, 1000);
camera.position.set(0, 5, 20);

// ================= RENDER =================
const renderer = new THREE.WebGLRenderer({ antialias:true });
renderer.setSize(window.innerWidth, window.innerHeight);
renderer.outputColorSpace = THREE.SRGBColorSpace;
document.body.appendChild(renderer.domElement);

// ================= CONTROLES =================
const controls = new OrbitControls(camera, renderer.domElement);
controls.enableDamping = true;

// ================= LUZ =================
const sun = new THREE.DirectionalLight(0xffffff, 3);
scene.add(sun);

scene.add(new THREE.AmbientLight(0xffffff,0.3));

// ================= SOLO =================
const ground = new THREE.Mesh(
    new THREE.CircleGeometry(200,64),
    new THREE.MeshStandardMaterial({ color:0x0f3d0f })
);
ground.rotation.x = -Math.PI/2;
scene.add(ground);

// ================= ESTRELAS =================
const starGeo = new THREE.BufferGeometry();
const vertices = [];
for(let i=0;i<3000;i++){
    vertices.push(
        THREE.MathUtils.randFloatSpread(400),
        THREE.MathUtils.randFloatSpread(400),
        THREE.MathUtils.randFloatSpread(400)
    );
}
starGeo.setAttribute('position', new THREE.Float32BufferAttribute(vertices,3));

const stars = new THREE.Points(
    starGeo,
    new THREE.PointsMaterial({ color:0xffffff })
);
scene.add(stars);

// ================= ESFERA =================
const sphere = new THREE.Mesh(
    new THREE.SphereGeometry(6,64,64),
    new THREE.MeshStandardMaterial({
        color:0x111111,
        metalness:0.9,
        roughness:0.2
    })
);
scene.add(sphere);

// ================= RECORTE VISUAL =================
// (simulação do furo)
const cutout = new THREE.Mesh(
    new THREE.PlaneGeometry(5,3),
    new THREE.MeshBasicMaterial({ color:0x000000 })
);
cutout.position.set(0,0,5.9);
scene.add(cutout);

// ================= RELÓGIO =================
const clockCanvas = document.createElement("canvas");
clockCanvas.width = 512;
clockCanvas.height = 256;
const ctx = clockCanvas.getContext("2d");

const texture = new THREE.CanvasTexture(clockCanvas);

const clockMesh = new THREE.Mesh(
    new THREE.PlaneGeometry(4.5,2),
    new THREE.MeshBasicMaterial({ map:texture })
);

clockMesh.position.set(0,0,6);
scene.add(clockMesh);

function updateClock(){
    const time = new Date().toLocaleTimeString();
    ctx.fillStyle="black";
    ctx.fillRect(0,0,512,256);
    ctx.fillStyle="#00ffff";
    ctx.font="bold 90px Arial";
    ctx.textAlign="center";
    ctx.fillText(time,256,160);
    texture.needsUpdate=true;
}
setInterval(updateClock,1000);
updateClock();

// ================= BLOOM =================
const composer = new EffectComposer(renderer);
composer.addPass(new RenderPass(scene,camera));

const bloom = new UnrealBloomPass(
    new THREE.Vector2(window.innerWidth,window.innerHeight),
    1.5,0.4,0.85
);
composer.addPass(bloom);

// ================= ANIMAÇÃO =================
let angle=0;

function animate(){
    requestAnimationFrame(animate);

    angle+=0.002;
    sun.position.set(
        Math.sin(angle)*50,
        Math.cos(angle)*50,
        0
    );

    sphere.rotation.y+=0.003;

    controls.update();
    composer.render();
}

animate();

// ================= RESPONSIVO =================
window.addEventListener("resize",()=>{
    camera.aspect = window.innerWidth/window.innerHeight;
    camera.updateProjectionMatrix();
    renderer.setSize(window.innerWidth,window.innerHeight);
    composer.setSize(window.innerWidth,window.innerHeight);
});

</script>
</body>
</html>
