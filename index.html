<!DOCTYPE html>
<html lang="pt">
<head>
<meta charset="UTF-8">
<title>Esfera Gênese</title>
<style>
    body { margin: 0; overflow: hidden; background: black; }
    canvas { display: block; }
</style>
</head>
<body>

<script type="module">

import * as THREE from 'https://cdn.jsdelivr.net/npm/three@0.160.0/build/three.module.js';
import { OrbitControls } from 'https://cdn.jsdelivr.net/npm/three@0.160.0/examples/jsm/controls/OrbitControls.js';
import { EffectComposer } from 'https://cdn.jsdelivr.net/npm/three@0.160.0/examples/jsm/postprocessing/EffectComposer.js';
import { RenderPass } from 'https://cdn.jsdelivr.net/npm/three@0.160.0/examples/jsm/postprocessing/RenderPass.js';
import { UnrealBloomPass } from 'https://cdn.jsdelivr.net/npm/three@0.160.0/examples/jsm/postprocessing/UnrealBloomPass.js';
import { CSG } from 'https://cdn.jsdelivr.net/npm/three-csg-ts@2.0.4/lib/esm/index.js';

// ================= CENA =================
const scene = new THREE.Scene();
scene.fog = new THREE.Fog(0x000000, 20, 150);

// ================= CÂMERA =================
const camera = new THREE.PerspectiveCamera(75, window.innerWidth/window.innerHeight, 0.1, 1000);
camera.position.set(0, 5, 20);

// ================= RENDER =================
const renderer = new THREE.WebGLRenderer({ antialias:true });
renderer.setSize(window.innerWidth, window.innerHeight);
renderer.outputColorSpace = THREE.SRGBColorSpace;
document.body.appendChild(renderer.domElement);

// ================= CONTROLES =================
const controls = new OrbitControls(camera, renderer.domElement);
controls.enableDamping = true;

// ================= LUZ =================
const sunLight = new THREE.DirectionalLight(0xffffff, 3);
scene.add(sunLight);

const ambient = new THREE.AmbientLight(0xffffff, 0.3);
scene.add(ambient);

// ================= SOLO =================
const ground = new THREE.Mesh(
    new THREE.CircleGeometry(200,64),
    new THREE.MeshStandardMaterial({ color:0x0f3d0f, roughness:0.9 })
);
ground.rotation.x = -Math.PI/2;
scene.add(ground);

// ================= ESTRELAS =================
const starsGeometry = new THREE.BufferGeometry();
const starVertices = [];
for(let i=0;i<5000;i++){
    starVertices.push(
        THREE.MathUtils.randFloatSpread(500),
        THREE.MathUtils.randFloatSpread(500),
        THREE.MathUtils.randFloatSpread(500)
    );
}
starsGeometry.setAttribute('position', new THREE.Float32BufferAttribute(starVertices,3));
const stars = new THREE.Points(
    starsGeometry,
    new THREE.PointsMaterial({ color:0xffffff })
);
scene.add(stars);

// ================= ESFERA COM FURO =================

// esfera principal
const sphereMesh = new THREE.Mesh(
    new THREE.SphereGeometry(6, 64, 64),
    new THREE.MeshStandardMaterial({
        color:0x111111,
        metalness:0.8,
        roughness:0.2
    })
);

// caixa que fará o furo
const boxMesh = new THREE.Mesh(
    new THREE.BoxGeometry(5, 2.5, 6),
    new THREE.MeshStandardMaterial()
);
boxMesh.position.set(0,0,3);

// CSG recorte
const sphereCSG = CSG.fromMesh(sphereMesh);
const boxCSG = CSG.fromMesh(boxMesh);
const subtractedCSG = sphereCSG.subtract(boxCSG);
const sphereWithHole = CSG.toMesh(subtractedCSG, sphereMesh.matrix, sphereMesh.material);

scene.add(sphereWithHole);

// ================= RELÓGIO =================
const clockCanvas = document.createElement("canvas");
clockCanvas.width = 512;
clockCanvas.height = 256;
const ctx = clockCanvas.getContext("2d");

const clockTexture = new THREE.CanvasTexture(clockCanvas);

const clockMaterial = new THREE.MeshBasicMaterial({
    map: clockTexture,
    emissive:0x00ffff
});

const clockScreen = new THREE.Mesh(
    new THREE.PlaneGeometry(4.5,2),
    clockMaterial
);

clockScreen.position.set(0,0,3.1);
scene.add(clockScreen);

function updateClock(){
    const time = new Date().toLocaleTimeString();
    ctx.fillStyle="black";
    ctx.fillRect(0,0,512,256);
    ctx.fillStyle="#00ffff";
    ctx.font="bold 90px Arial";
    ctx.textAlign="center";
    ctx.fillText(time,256,160);
    clockTexture.needsUpdate=true;
}
setInterval(updateClock,1000);
updateClock();

// ================= BLOOM =================
const composer = new EffectComposer(renderer);
composer.addPass(new RenderPass(scene,camera));
const bloomPass = new UnrealBloomPass(
    new THREE.Vector2(window.innerWidth,window.innerHeight),
    1.5,0.4,0.85
);
composer.addPass(bloomPass);

// ================= ANIMAÇÃO SOL =================
let angle = 0;

function animate(){
    requestAnimationFrame(animate);

    angle += 0.002;
    sunLight.position.set(
        Math.sin(angle)*50,
        Math.cos(angle)*50,
        0
    );

    controls.update();
    composer.render();
}

animate();

// ================= RESPONSIVO =================
window.addEventListener("resize",()=>{
    camera.aspect = window.innerWidth/window.innerHeight;
    camera.updateProjectionMatrix();
    renderer.setSize(window.innerWidth,window.innerHeight);
    composer.setSize(window.innerWidth,window.innerHeight);
});

</script>
</body>
</html>
